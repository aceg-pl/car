<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>EU Auto Competitor Model Matrix</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  :root{
    --bg:#0f1115; --fg:#e8eaed; --muted:#9aa0a6; --line:#2a2f3a;
    --site-header-h: 66px;
  }

  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--fg);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial}

  header{position:sticky;top:0;background:#0f1115;z-index:30;border-bottom:1px solid var(--line)}
  .wrap{max-width:1200px;margin:0 auto;padding:16px}
  .row{display:flex;gap:12px;align-items:center}
  h1{font-size:18px;margin:0 0 8px 0;font-weight:600;flex:1 1 auto}

  .controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
  label{color:var(--muted)}
  select,button{background:#151924;color:var(--fg);border:1px solid var(--line);padding:8px 10px;border-radius:8px;cursor:pointer}
  button:hover{border-color:#3a4252}

  .grid{
    overflow:auto;
    max-height:70vh;
    border:1px solid var(--line);
    border-radius:10px;
    background:#0f1115;
    position:relative;
  }

  table{width:100%;border-collapse:separate;border-spacing:0;margin:0}
  th,td{border-bottom:1px solid var(--line);padding:8px 10px;vertical-align:middle;background:#0f1115}
  tbody tr:hover td{background:#131824}

  thead th{
    position:sticky;
    top: 0;
    z-index: 20;
    background:#0f1115;
    box-shadow: 0 1px 0 0 #2a2f3a;
  }

  #matrixTable th:first-child,
  #matrixTable td:first-child{
    position:sticky;
    left:0;
    z-index: 10;
    background:#0f1115;
    box-shadow: 1px 0 0 #2a2f3a;
    white-space:nowrap;
  }
  #matrixTable thead th:first-child{ z-index: 25 }

  .seg{white-space:nowrap;color:#cbd1d9;font-weight:600}
  .brandcell{display:flex;align-items:center;gap:8px;white-space:nowrap}
  .brandname{color:#cbd1d9}
  .tag{font-size:11px;padding:2px 6px;border:1px solid var(--line);border-radius:6px;background:#121725;color:#9aa0a6;margin-left:6px}
  .model{color:var(--fg)}
  .blank{color:#9aa0a6}
  .note{font-size:12px;color:#9aa0a6;margin-top:8px}
  .icon{width:18px;height:18px;display:inline-block;vertical-align:middle;filter: invert(90%) sepia(5%) saturate(200%) hue-rotate(180deg) brightness(95%) contrast(90%)}

  /* Group header row with consistent bg color */
  .group-row td{
    background:#1e2536;
    color:#a0b3d6;
    font-weight:600;
    border-bottom:1px solid var(--line);
  }
  .group-row td:first-child{
    position:sticky;
    left:0;
    z-index:16;
    box-shadow:1px 0 0 #2a2f3a;
    white-space:nowrap;
    background:#1e2536;
    /* Tweak for tighter fit in mobile/first column: less horizontal padding */
    padding: 8px 6px; 
  }
  
  /* Hide brand count/meta info */
  .group-meta{ 
    display: none; 
  }
  
  .group-toggle{
    cursor:pointer;
    user-select:none;
    margin-right:4px; /* Reduced margin */
    display:inline-block;
    width:1.1em;
    text-align:center;
    border:1px solid var(--line);
    border-radius:4px;
    background:#121725;
    color:#9aa0a6;
    line-height:1em;
    padding:2px;
  }
  .group-toggle:focus{outline:2px solid #3a6df0;outline-offset:2px}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="row">
      <h1>EU Auto Competitor Model Matrix</h1>
      <div class="controls">
        <label for="viewSelect">View:</label>
        <select id="viewSelect" aria-label="View selector">
          <option value="all">All models</option>
          <option value="seg0">Compact Hatch/Sedan</option>
          <option value="seg1">Mid-Size Sedan</option>
          <option value="seg2">Executive Sedan</option>
          <option value="seg3">Compact SUV</option>
          <option value="seg4">Mid-Size SUV</option>
          <option value="seg5">Large / 3-Row</option>
        </select>
      </div>
      <div class="controls">
        <button id="downloadCsvBtn" type="button">Export CSV</button>
      </div>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="grid" id="grid">
    <table id="matrixTable" aria-describedby="matrixNote">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
(function(){
  function setHeaderOffset(){
    const hdr = document.querySelector('header');
    const h = hdr ? Math.round(hdr.getBoundingClientRect().height) : 66;
    document.documentElement.style.setProperty('--site-header-h', h + 'px');
  }

  const ICON_CDN = 'https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/';
  const ICON_SLUG = {
    "Audi":"audi","BMW":"bmw","Mercedes":"mercedes","Tesla":"tesla","Volvo":"volvo",
    "Lexus":"lexus","Genesis":"genesis","Porsche":"porsche","Jaguar":"jaguar","Land Rover":"landrover",
    "Alfa Romeo":"alfaromeo","Polestar":"polestar","Nio":"nio","BYD":"byd","Lucid":"lucid",
    "Volkswagen":"volkswagen","Škoda":"skoda","Cupra":"cupra","Peugeot":"peugeot","Citroën":"citroen",
    "Hyundai":"hyundai","Kia":"kia","Mazda":"mazda",
    "Ford":"ford","Honda":"honda","Toyota":"toyota","Renault":"renault","Opel":"opel","Vauxhall":"vauxhall",
    "Dacia":"dacia","SEAT":"seat","Nissan":"nissan","Suzuki":"suzuki","Mitsubishi":"mitsubishi","Subaru":"subaru",
    "DS":"dsautomobiles","Jeep":"jeep","Fiat":"fiat","MG":"mg"
  };

  const SEGMENTS = [
    "Compact Hatch/Sedan",
    "Mid-Size Sedan",
    "Executive Sedan",
    "Compact SUV",
    "Mid-Size SUV",
    "Large / 3-Row"
  ];

  const DATA = {
    "Audi": ["A3 Hatch / Sedan","A4 Sedan","A6 Sedan","Q3 SUV","Q5 SUV","Q7 SUV"],
    "BMW": ["1-Series Hatch","3-Series Sedan","5-Series Sedan","X1 SAV","X3 SAV","X5 SAV"],
    "BMW (Alt)": ["2-Series Gran Coupe","i4 Gran Coupe (EV)","i5 Sedan (EV)","iX1 (EV)","iX3 (EV)","X7 SAV"],
    "BMW (Addl)": ["(Blank)","(Blank)","8-Series Gran Coupe","X2 SAV","X4 SAV","(Blank)"],
    "Mercedes": ["A-Class Hatch","C-Class Sedan","E-Class Sedan","GLA SUV","GLC SUV","GLE SUV"],
    "Mercedes (Alt)": ["CLA-Class Sedan","CLE-Class","EQE Sedan (EV)","EQA (EV)","EQC (EV)","EQS SUV (EV)"],
    "Mercedes (Addl)": ["(Blank)","(Blank)","S-Class Sedan","(Blank)","GLC Coupe","GLS SUV"],
    "Tesla": ["Model 3 (Entry)","Model 3 (Core)","Model S","Model Y (Entry)","Model Y (Core)","Model X"],
    "Volvo": ["C40 (EV)","S60 Sedan","S90 Sedan","XC40 SUV","XC60 SUV","XC90 SUV"],
    "Volvo (Alt)": ["EX30 (EV)","(Blank)","(Blank)","EX40 (EV)","(Blank)","EX90 (EV)"],
    "Lexus": ["CT 200h","IS Sedan","ES Sedan","UX Crossover","NX Crossover","RX SUV"],
    "Lexus (Alt)": ["(Blank)","(Blank)","LS Sedan","(Blank)","RZ (EV)","TX SUV"],
    "Genesis": ["(Blank)","G70 Sedan","G80 Sedan","GV60 (EV)","GV70 SUV","GV80 SUV"],
    "Porsche": ["(Blank)","(Blank)","Panamera","Macan","Cayenne","Cayenne Coupe"],
    "Jaguar": ["(Blank)","XE Sedan","XF Sedan","E-Pace SUV","F-Pace SUV","I-Pace (EV)"],
    "Land Rover": ["(Blank)","(Blank)","(Blank)","Discovery Sport","Range Rover Velar","Discovery"],
    "Land Rover (Alt)": ["(Blank)","(Blank)","(Blank)","Range Rover Evoque","Defender 90/110/130","Range Rover Sport"],
    "Alfa Romeo": ["Giulietta","Giulia Sedan","(Blank)","Tonale","Stelvio SUV","(Blank)"],
    "Polestar": ["2 Sedan","2 Sedan","3 SUV (Large EV)","4 SUV","(Blank)","(Blank)"],
    "Nio": ["ET5","ET5 Touring","ET7 Sedan","EL6 SUV","EL7 SUV","ES8 SUV"],
    "BYD": ["Dolphin","Seal Sedan","(Blank)","Atto 3","Seal U SUV","Tang SUV"],
    "Lucid": ["(Blank)","(Blank)","Air Sedan","(Blank)","(Blank)","(Blank)"],
    "Volkswagen": ["Golf Hatch","Passat Sedan/Estate","Arteon","T-Roc","Tiguan","Touareg"],
    "Škoda": ["Octavia","Superb","Superb","Kamiq","Karoq","Kodiaq"],
    "Škoda (Alt)": ["Enyaq (EV)","(Blank)","(Blank)","(Blank)","Enyaq Coupe (EV)","(Blank)"],
    "Cupra": ["Leon","Leon","(Blank)","Formentor","Tavascan (EV)","(Blank)"],
    "Cupra (Alt)": ["Born (EV)","(Blank)","(Blank)","(Blank)","(Blank)","(Blank)"],
    "Peugeot": ["308 Hatch","508 Sedan/SW","(Blank)","2008","3008","5008"],
    "Citroën": ["C4","C5 X","(Blank)","C3 Aircross","C5 Aircross","(Blank)"],
    "Hyundai": ["i30","Ioniq 6 (EV)","(Blank)","Kona","Tucson","Santa Fe"],
    "Kia": ["Ceed","EV6 (EV)","(Blank)","Niro","Sportage","Sorento"],
    "Mazda": ["3","6","(Blank)","CX-30","CX-5","CX-60/CX-80"],
    "Ford": ["(Blank)","(Blank)","(Blank)","Puma / Explorer (EV)","Kuga / Mustang Mach‑E","(Blank)"],
    "Honda": ["Civic","(Blank)","(Blank)","HR‑V / ZR‑V","CR‑V","(Blank)"],
    "Toyota": ["Corolla","Camry","(Blank)","C‑HR","RAV4 / bZ4X","Highlander"],
    "Renault": ["Clio / Mégane E‑Tech","(Blank)","(Blank)","Captur / Austral","Austral / Espace","(Blank)"],
    "Opel": ["Corsa","Astra","(Blank)","Mokka","Grandland","(Blank)"],
    "Vauxhall": ["Corsa","Astra","(Blank)","Mokka","Grandland","(Blank)"],
    "Dacia": ["Sandero","(Blank)","(Blank)","Duster","Jogger (2‑row/3‑row alt)","Jogger (3‑row)"],
    "SEAT": ["Ibiza / Leon","Leon","(Blank)","Arona","Ateca","(Blank)"],
    "Nissan": ["(Blank)","(Blank)","(Blank)","Juke","Qashqai","X‑Trail"],
    "Suzuki": ["Swift","(Blank)","(Blank)","Vitara","S‑Cross","(Blank)"],
    "Mitsubishi": ["(Blank)","(Blank)","(Blank)","ASX","Eclipse Cross","(Blank)"],
    "Subaru": ["(Blank)","(Blank)","(Blank)","Crosstrek","Forester","(Blank)"],
    "DS": ["DS 3","DS 4","(Blank)","DS 3","DS 7","(Blank)"],
    "Jeep": ["(Blank)","(Blank)","(Blank)","Avenger","Compass","(Blank)"],
    "Fiat": ["500e / 600e","(Blank)","(Blank)","600e","500X (legacy)","(Blank)"],
    "MG": ["MG4","(Blank)","(Blank)","ZS","Marvel R","(Blank)"]
  };

  const GROUPS = {
    "Audi":"VW Group","Volkswagen":"VW Group","Škoda":"VW Group","SEAT":"VW Group","Cupra":"VW Group","Porsche":"VW Group",
    "BMW":"BMW Group",
    "Mercedes":"Mercedes Group",
    "Peugeot":"Stellantis","Citroën":"Stellantis","DS":"Stellantis","Opel":"Stellantis","Vauxhall":"Stellantis","Fiat":"Stellantis","Jeep":"Stellantis","Alfa Romeo":"Stellantis",
    "Hyundai":"Hyundai Motor","Kia":"Hyundai Motor","Genesis":"Hyundai Motor",
    "Toyota":"Toyota Group","Lexus":"Toyota Group",
    "Nissan":"Nissan–Mitsubishi","Mitsubishi":"Nissan–Mitsubishi","Renault":"Renault Group","Dacia":"Renault Group",
    "Jaguar":"JLR","Land Rover":"JLR",
    "Volvo":"Geely Group","Polestar":"Geely Group","MG":"SAIC",
    "Ford":"Ford","Mazda":"Mazda","Honda":"Honda","Suzuki":"Suzuki","BYD":"BYD","Nio":"Nio","Lucid":"Lucid","Tesla":"Tesla"
  };

  const viewSelect = document.getElementById('viewSelect');
  const thead = document.querySelector('#matrixTable thead');
  const tbody = document.querySelector('#matrixTable tbody');

  function baseBrands(){
    const set = new Set();
    Object.keys(DATA).forEach(k => set.add(k.replace(/\s*\(.*\)$/, '')));
    return Array.from(set).sort((a,b)=> a.localeCompare(b,'en',{sensitivity:'base'}));
  }
  function brandRows(base){
    const keys = Object.keys(DATA).filter(k => k === base || k.startsWith(base + ' '));
    const order = k => k.includes('(Alt)') ? 1 : k.includes('(Addl)') ? 2 : 0;
    return keys.sort((a,b)=> order(a)-order(b));
  }
  function iconURL(base){
    const slug = ICON_SLUG[base];
    return slug ? ICON_CDN + slug + '.svg' : null;
  }
  function getView(){
    const v = viewSelect.value;
    if (v === 'all') return { all:true, seg:-1 };
    const idx = Number(v.replace('seg',''));
    return { all:false, seg: (Number.isFinite(idx)&&idx>=0&&idx<6)?idx:0 };
  }
  function groupKeyFor(base){
    return GROUPS[base] || 'Other';
  }
  function groupedBases(){
    const bases = baseBrands();
    const byGroup = {};
    bases.forEach(b=>{
      const g = groupKeyFor(b);
      (byGroup[g] ||= []).push(b);
    });
    const groupNames = Object.keys(byGroup).sort((a,b)=> a.localeCompare(b,'en',{sensitivity:'base'}));
    return { groupNames, byGroup };
  }

  const collapsed = new Map();

  function renderHeader(){
    thead.innerHTML = '';
    const tr = document.createElement('tr');

    const thBrand = document.createElement('th');
    thBrand.textContent = 'Brand';
    tr.appendChild(thBrand);

    const {all, seg} = getView();
    if (all){
      SEGMENTS.forEach(name => {
        const th = document.createElement('th');
        th.innerHTML = `<div class="seg">${name}</div>`;
        tr.appendChild(th);
      });
    } else {
      const th = document.createElement('th');
      th.innerHTML = `<div class="seg">${SEGMENTS[seg]}</div>`;
      tr.appendChild(th);
    }
    thead.appendChild(tr);
  }

  function renderBody(){
    tbody.innerHTML = '';
    const {all, seg} = getView();
    const {groupNames, byGroup} = groupedBases();

    groupNames.forEach(groupName => {
      const trG = document.createElement('tr');
      trG.className = 'group-row';

      const tdG = document.createElement('td');
      const toggle = document.createElement('button');
      toggle.type = 'button';
      toggle.className = 'group-toggle';
      toggle.setAttribute('aria-expanded', (!collapsed.get(groupName)).toString());
      toggle.setAttribute('aria-controls', `grp-${groupName.replace(/\W+/g,'_')}`);
      toggle.textContent = collapsed.get(groupName) ? '+' : '–';

      const label = document.createElement('span');
      label.textContent = groupName;

      // REMOVED THE CREATION OF THE BRAND COUNT/META SPAN

      tdG.appendChild(toggle);
      tdG.appendChild(label);
      // tdG.appendChild(meta); // This line is now effectively removed
      trG.appendChild(tdG);

      const colCount = all ? 6 : 1;
      for (let i=0;i<colCount;i++){
        const td = document.createElement('td');
        td.textContent = '';
        trG.appendChild(td);
      }
      tbody.appendChild(trG);

      byGroup[groupName].forEach(base => {
        brandRows(base).forEach(key => {
          const tr = document.createElement('tr');
          tr.dataset.inGroup = groupName;
          tr.id = `grp-${groupName.replace(/\W+/g,'_')}`;
          if (collapsed.get(groupName)) tr.style.display = 'none';

          const tdBrand = document.createElement('td');
          const url = iconURL(base);
          const img = url ? `<img class="icon" alt="${base}" src="${url}" onerror="this.style.display='none'">` : '';
          tdBrand.innerHTML = `<div class="brandcell">${img}<span class="brandname">${base}</span>${key!==base?`<span class="tag">${key.replace(base,'').trim()}</span>`:''}</div>`;
          tr.appendChild(tdBrand);

          const models = DATA[key] || [];
          if (all){
            for (let i=0;i<6;i++){
              const td = document.createElement('td');
              const v = models[i] || '(Blank)';
              td.innerHTML = v==='(Blank)' ? `<span class="blank">(Blank)</span>` : `<span class="model">${v}</span>`;
              tr.appendChild(td);
            }
          } else {
            const td = document.createElement('td');
            const v = models[seg] || '(Blank)';
            td.innerHTML = v==='(Blank)' ? `<span class="blank">(Blank)</span>` : `<span class="model">${v}</span>`;
            tr.appendChild(td);
          }
          tbody.appendChild(tr);
        });
      });

      toggle.addEventListener('click', ()=>{
        const isCollapsed = collapsed.get(groupName) === true;
        const nextState = !isCollapsed;
        collapsed.set(groupName, nextState);
        toggle.textContent = nextState ? '+' : '–';
        toggle.setAttribute('aria-expanded', nextState.toString());

        let n = trG.nextElementSibling;
        while (n && !n.classList.contains('group-row')){
          n.style.display = nextState ? '' : 'none';
          n = n.nextElementSibling;
        }
      });
    });
  }

  function exportCSV(){
    const rows = [];
    const {all, seg} = getView();
    if (all){
      rows.push(['Brand Group','Brand', ...SEGMENTS]);
    } else {
      rows.push(['Brand Group','Brand', SEGMENTS[seg]]);
    }

    const {groupNames, byGroup} = groupedBases();
    groupNames.forEach(groupName=>{
      byGroup[groupName].forEach(base=>{
        brandRows(base).forEach(key=>{
          const models = DATA[key] || [];
          const brandLabel = base + (key!==base?` ${key.replace(base,'')}`:'');
          if (all){
            rows.push([groupName, brandLabel, ...models.map(x=> x||'(Blank)')]);
          } else {
            rows.push([groupName, brandLabel, models[seg] || '(Blank)']);
          }
        });
      });
    });

    const csv = rows.map(r => r.map(s => {
      const t = String(s);
      return /[",\n]/.test(t) ? `"${t.replace(/"/g,'""')}"` : t;
    }).join(',')).join('\n');
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = all ? 'EU_Auto_Competitor_Model_Matrix_all.csv'
                     : `EU_Auto_Competitor_Model_Matrix_${SEGMENTS[seg].replace(/\s+/g,'_')}.csv`;
    document.body.appendChild(a);
    a.click();
    a.remove();
  }

  function start(){
    setHeaderOffset();
    renderHeader();
    renderBody();
    window.addEventListener('resize', setHeaderOffset, {passive:true});
    viewSelect.addEventListener('change', () => { renderHeader(); renderBody(); });
    document.getElementById('downloadCsvBtn').addEventListener('click', exportCSV);
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', start);
  } else {
    start();
  }
})();
</script>
</body>
</html>
